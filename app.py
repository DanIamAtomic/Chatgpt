import os
import openai
from PIL import Image
import streamlit as st
openai.api_key = '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'

st.set_page_config(
    page_title="ChatGPT + DALL-E 2",
    page_icon="‚ú®",
    layout="centered",
    initial_sidebar_state="auto",
)

@st.cache(persist=True,allow_output_mutation=True,show_spinner=False,suppress_st_warning=True)
def openai_completion(prompt):
    response = openai.Completion.create(
      model="text-davinci-003",
      prompt=prompt,
      max_tokens=150,
      temperature=0.5
    )
    return response['choices'][0]['text']

@st.cache(persist=True,allow_output_mutation=True,show_spinner=False,suppress_st_warning=True)
def openai_image(prompt):
    response = openai.Image.create(
      prompt=prompt,
      n=1,
      size="256x256"
    )
    image_url = response['data'][0]['url']
    return image_url

top_image = Image.open('static/banner_top.png')
bottom_image = Image.open('static/banner_bottom.png')
main_image = Image.open('static/main_banner.png')

st.sidebar.image(top_image,use_column_width='auto')
format_type = st.sidebar.selectbox('–í–∏–±–µ—Ä—ñ—Ç—å —Å–≤–æ–≥–æ —á–∞—Ä—ñ–≤–Ω–∏–∫–∞ OpenAI üòâ',["ChatGPT","DALL-E 2"])
st.sidebar.image(bottom_image,use_column_width='auto')

st.image(main_image,use_column_width='auto')
st.title("üìÑ ChatGPT + DALL-E üèú")

if format_type == "ChatGPT":
    input_text = st.text_area("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç —Ç—É—Ç... üôã",height=50)
    chat_button = st.button("–ó—Ä–æ–±—ñ—Ç—å –º–∞–≥—ñ—é! ‚ú®")

    if chat_button and input_text.strip() != "":
        with st.spinner("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...üí´"):
            openai_answer = openai_completion(input_text)
            st.success(openai_answer)
    else:
        st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —â–æ—Å—å! ‚ö†")

else:
    input_text = st.text_area("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç —Ç—É—Ç... üôã",height=50)
    image_button = st.button("–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è üöÄ")

    if image_button and input_text.strip() != "":
        with st.spinner("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...üí´"):
            image_url = openai_image(input_text)
            st.image(image_url, caption='Generated by OpenAI')
    else:
        st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —â–æ—Å—å! ‚ö†")

st.markdown("<br><hr><center>Made with by <a href='mailto:gvgg4497@gmail.com?subject=ChatGPT + DALL-E WebApp!&body=Please specify the issue you are facing with the app.'><strong>Danylo Shapovalov</strong></a></center><hr>", unsafe_allow_html=True)
st.markdown("<style> footer {visibility: hidden;} </style>", unsafe_allow_html=True)
